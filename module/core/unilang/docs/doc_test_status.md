# doc test status

## summary

**Current Status:** 35 passed, 0 failed, 19 ignored

This document categorizes all 19 intentionally ignored doc tests in the unilang codebase, explaining why each category remains ignored and what tests were successfully enabled.

## test enablement progress

**Initial State:** 34 ignored doc tests
**Enabled:** 14 doc tests
**Removed:** 1 deprecated API doc test
**Final State:** 19 ignored doc tests

### enabled tests

**src/registry.rs** (5 tests enabled)
- `set_registry_mode` (line 567) - Added `#[allow(deprecated)]`
- `register_with_auto_help` (line 629) - Fixed method call order and OutputData construction
- `get_help_for_command` (line 673) - Added `#[allow(deprecated)]`
- `command_with_routine` (line 952) - Removed unnecessary ignore marker
- `StaticCommandRegistry` (line 1029) - Added missing RegistryMode import

**src/pipeline.rs** (9 tests enabled)
- `process_command` (line 618) - Fixed deprecated API and command naming
- `process_command_from_argv` (line 742, 770) - Simplified complex examples (2 tests)
- `process_command_from_argv_simple` (line 877) - Removed env::args() dependency
- `process_batch` (line 912) - Fixed command naming
- `process_help_request` (line 1052) - Added missing registry creation
- `process_single_command` (line 1091) - Fixed command naming
- `requires_interactive_input` (line 240) - Simplified REPL integration example
- `is_help_response` (line 290) - Simplified REPL integration example
- `process_command_from_argv` good pattern (line 742) - Enabled correct usage example

## ignored test categories

**Summary:** 19 tests remain ignored across 5 categories

### category 1: toml configuration blocks (10 tests)

**Location:** src/lib.rs lines 60, 78, 133, 187, 235, 254, 264, 349, 358, 371

**Rationale:** These are TOML code blocks in documentation showing Cargo.toml configuration examples. Cargo correctly identifies these as non-Rust code and ignores them automatically.

**Example:**
```toml
[dependencies]
unilang = { version = "0.10", features = ["enhanced_repl", "simd"] }
```

**Action:** Keep ignored - this is correct behavior.

### category 2: anti-pattern examples (2 tests)

**Location:** src/registry.rs lines 142, 154

**Struct:** `PerformanceMetrics`

**Rationale:** These examples deliberately demonstrate what NOT to do. They show incorrect usage patterns that would compile but represent anti-patterns in the codebase design.

**Action:** Keep ignored - these serve as negative examples in documentation.

### category 3: deprecated api documentation (0 tests)

**Status:** All deprecated APIs have been removed from the codebase.

**Note:** The deprecated `enable_help_conventions` function has been completely removed. Help generation is now mandatory for all commands with no opt-out mechanism.

### category 4: build-context dependencies (3 tests)

**Locations:**
- src/registry.rs line 811 - `from_static_commands`
- src/registry.rs line 1092 - `StaticCommandRegistry::from_commands`
- src/static_data.rs line 450 - `StaticCommandMap`

**Rationale:** These examples reference `STATIC_COMMANDS` or other symbols generated by build.rs at compile time. They only work in the context of a full application build where the build script has run and generated the static command data.

**Example:**
```rust
let registry = CommandRegistry::from_static_commands(&STATIC_COMMANDS);
```

**Action:** Keep ignored - these require build-time code generation context that doesnt exist in doc test environment.

### category 5: anti-pattern comparison examples (1 test)

**Location:** src/pipeline.rs line 781

**Rationale:** Shows the WRONG way to use the API (❌ BAD pattern) as a comparison to demonstrate why the argv-based API is needed. The example intentionally shows code that causes parse errors.

**Action:** Keep ignored - this is a negative example for documentation purposes.

### category 6: module-level integration examples (3 tests)

**Locations:**
- src/lib.rs line 186 (semantic module)
- src/lib.rs line 191 (simd_json_parser module)
- src/lib.rs line 208 (simd_json_parser module)

**Rationale:** Module-level documentation examples that demonstrate complex integration patterns requiring:
- Multiple modules working together
- Feature-specific compilation
- External dependencies or specific runtime contexts

**Action:** Keep ignored - these provide overview documentation of module capabilities.

## testing strategy

### what gets enabled
- ✅ Basic API usage examples
- ✅ Current (non-deprecated) API patterns
- ✅ Standalone examples with all dependencies available
- ✅ Examples that compile and run without external context

### what stays ignored
- ❌ TOML configuration blocks
- ❌ Anti-pattern demonstrations
- ❌ Deprecated API documentation
- ❌ Build-time generated code references
- ❌ Complex integration requiring runtime features
- ❌ Interactive REPL session examples

## validation

Run comprehensive doc tests:
```bash
cargo test --doc --all-features
```

Expected output:
```
test result: ok. 35 passed; 0 failed; 19 ignored
```

## maintenance

When adding new doc tests:
1. Default to runnable examples (`cargo test --doc` should pass)
2. Only add `ignore` attribute for valid reasons (see categories above)
3. Document complex examples inline with `#` hidden lines for setup
4. Use `#[allow(deprecated)]` for showing old APIs alongside new ones
5. Wrap examples requiring `?` operator in `# fn example() -> Result<(), unilang::Error> { ... }`

## references

- Test enablement work tracked in git history (cleaning_5 branch)
- Related: `tests/` directory for integration tests
- Related: `benches/` directory for performance benchmarks
