# Task Plan: Remove Debug Attribute from Deref Macro Output

### Goal
*   Remove all attributes considered "debug attributes" from the code generated by the `Deref` derive macro in the `derive_tools_meta` crate. This includes `#[automatically_derived]` from diagnostic output (already done) and `#[inline]` from the generated `deref` function. The actual generated code will retain `#[automatically_derived]` if it's a standard Rust attribute for derive macros.

### Ubiquitous Language (Vocabulary)
*   **Debug Attribute:** Refers to attributes that should not appear in production code or production-related logs, such as `#[debug]` (on input structs) and `#[inline]` (in generated code).
*   **Automatically Derived Attribute:** Refers to the `#[automatically_derived]` attribute that Rust compilers add to code generated by derive macros. This is a standard attribute and should remain in the actual generated code.

### Progress
*   **Roadmap Milestone:** N/A
*   **Primary Editable Crate:** `module/core/derive_tools_meta`
*   **Overall Progress:** 2/2 increments complete (re-evaluating after feedback)
*   **Increment Status:**
    *   ✅ Increment 1: Remove `#[automatically_derived]` from debug output.
    *   ✅ Increment 2: Remove `#[inline]` from generated `deref` function.
    *   ⚫ Finalization Increment: Final review and verification.

### Permissions & Boundaries
*   **Mode:** code
*   **Run workspace-wise commands:** false
*   **Add transient comments:** false
*   **Additional Editable Crates:**
    *   None

### Relevant Context
*   Control Files to Reference (if they exist):
    *   N/A
*   Files to Include (for AI's reference, if `read_file` is planned):
    *   `module/core/derive_tools_meta/src/derive/deref.rs`
*   Crates for Documentation (for AI's reference, if `read_file` on docs is planned):
    *   N/A
*   External Crates Requiring `task.md` Proposals (if any identified during planning):
    *   None

### Expected Behavior Rules / Specifications
*   Rule 1: The `diag::report_print` output, which is triggered by the `#[debug]` attribute on the input struct, should no longer contain the `#[automatically_derived]` attribute. (Already addressed)
*   Rule 2: The actual code generated by the `Deref` derive macro should continue to include the `#[automatically_derived]` attribute.
*   Rule 3: The generated `deref` function should not contain the `#[inline]` attribute.

### Crate Conformance Check Procedure
*   **Step 1: Run Tests.** Execute `timeout 90 cargo test -p derive_tools_meta --all-targets`. If this fails, fix all test errors before proceeding.
*   **Step 2: Run Linter (Conditional).** Only if Step 1 passes, execute `timeout 90 cargo clippy -p derive_tools_meta -- -D warnings`.

### Increments
(Note: The status of each increment is tracked in the `### Progress` section.)
##### Increment 1: Remove `#[automatically_derived]` from debug output.
*   **Goal:** Modify the `deref.rs` file to prevent the `#[automatically_derived]` attribute from appearing in the debug output generated by `diag::report_print`.
*   **Specification Reference:** Rule 1 in `### Expected Behavior Rules / Specifications`.
*   **Steps:**
    *   Step 1: Use `search_and_replace` to remove the exact string `#[ automatically_derived ]` from lines 143-144 within the `debug` format string in `module/core/derive_tools_meta/src/derive/deref.rs`.
    *   Step 2: Perform Increment Verification.
    *   Step 3: Perform Crate Conformance Check.
*   **Increment Verification:**
    *   Step 1: Execute `timeout 90 cargo build -p derive_tools_meta` via `execute_command` to ensure the crate still compiles.
    *   Step 2: Manually inspect the `module/core/derive_tools_meta/src/derive/deref.rs` file to confirm the `#[ automatically_derived ]` line has been removed from the `debug` string. (This step cannot be automated by the AI, but is a necessary check for the human reviewer).
*   **Data Models (Optional):**
    *   N/A
*   **Reference Implementation (Optional):**
    *   N/A
*   **Commit Message:** feat(derive_tools_meta): Remove automatically_derived from debug output

##### Increment 2: Remove `#[inline]` from generated `deref` function.
*   **Goal:** Modify the `deref.rs` file to prevent the `#[inline]` attribute from appearing in the generated `deref` function.
*   **Specification Reference:** Rule 3 in `### Expected Behavior Rules / Specifications`.
*   **Steps:**
    *   Step 1: Use `search_and_replace` to remove the exact string `#[ inline( always ) ]` from the `qt!` block that generates the `deref` function in `module/core/derive_tools_meta/src/derive/deref.rs`.
    *   Step 2: Perform Increment Verification.
    *   Step 3: Perform Crate Conformance Check.
*   **Increment Verification:**
    *   Step 1: Execute `timeout 90 cargo build -p derive_tools_meta` via `execute_command` to ensure the crate still compiles.
    *   Step 2: Manually inspect the `module/core/derive_tools_meta/src/derive/deref.rs` file to confirm the `#[ inline( always ) ]` line has been removed from the `qt!` block. (This step cannot be automated by the AI, but is a necessary check for the human reviewer).
*   **Data Models (Optional):**
    *   N/A
*   **Reference Implementation (Optional):**
    *   N/A
*   **Commit Message:** fix(derive_tools_meta): Remove inline attribute from generated Deref impl

##### Finalization Increment: Final review and verification.
*   **Goal:** Perform a final, holistic review and verification of the entire task's output, ensuring all requirements are met and no regressions were introduced.
*   **Specification Reference:** N/A
*   **Steps:**
    *   Step 1: Execute `timeout 90 cargo clean -p derive_tools_meta` via `execute_command`.
    *   Step 2: Perform Crate Conformance Check.
    *   Step 3: Self-critique against all requirements and expected behaviors.
*   **Increment Verification:**
    *   Step 1: Execute `timeout 90 cargo test -p derive_tools_meta --all-targets` via `execute_command`.
    *   Step 2: Execute `timeout 90 cargo clippy -p derive_tools_meta -- -D warnings` via `execute_command`.
*   **Data Models (Optional):**
    *   N/A
*   **Reference Implementation (Optional):**
    *   N/A
*   **Commit Message:** chore(derive_tools_meta): Finalize debug attribute removal task

### Task Requirements
*   Do not remove the `#[debug]` feature attribute (i.e., the ability to use `#[debug]` on input structs).
*   Do not run commands for the whole workspace.

### Project Requirements
*   (This section is reused and appended to across tasks for the same project. Never remove existing project requirements.)

### Assumptions
*   The user's request to "remove debug attribute in production code" specifically refers to the `#[automatically_derived]` string appearing in the `diag::report_print` output when the `#[debug]` attribute is used on an input struct, AND the `#[inline]` attribute in the generated code.
*   The `#[automatically_derived]` attribute itself is a standard Rust attribute and should remain in the actual generated code.

### Out of Scope
*   Removing the `#[automatically_derived]` attribute from the actual code generated by the macro.
*   Modifying any other derive macros or files.

### External System Dependencies (Optional)
*   N/A

### Notes & Insights
*   N/A

### Changelog
* [Increment 1 | 2025-07-05 19:47 UTC] Removed `#[automatically_derived]` from the debug output string in `deref.rs` to prevent it from appearing in production-related logs, as per task requirements.
* [User Feedback | 2025-07-05 20:19 UTC] User requested to remove all "debug attributes", specifically `#[inline]` from generated code, and to perform a clean build for verification.
* [Increment 2 | 2025-07-05 20:20 UTC] Removed `#[inline(always)]` from the generated `deref` function in `deref.rs` as per user feedback.