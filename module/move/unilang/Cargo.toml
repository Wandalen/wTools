[package]
name = "unilang"
version = "0.23.0"
edition = "2021"
rust-version = "1.70"
authors = [
  "Kostiantyn Wandalen <wandalen@obox.systems>",
]
license = "MIT"
readme = "readme.md"
documentation = "https://docs.rs/unilang"
repository = "https://github.com/Wandalen/wTools/tree/master/module/move/unilang"
homepage = "https://github.com/Wandalen/wTools/tree/master/module/move/unilang/readme.md"
description = """
Define your command-line utility interface once and get consistent interaction across multiple modalities — CLI, GUI, TUI, AUI, Web APIs, and more—essentially for free.
"""
categories = [ "command-line-interface", "command-line-utilities" ]
keywords = [ "wtools", "CLI", "CUI", "user-interface" ]
# Note: stress_test_bin in tests/ causes a harmless warning about duplicate targets

[lints]
workspace = true

[package.metadata.docs.rs]
features = [ "full", "error_tools/enabled", "mod_interface/enabled", "former/enabled" ]
all-features = false

[features]
default = [ "enabled", "simd", "repl", "enhanced_repl" ]
full = [ "enabled", "on_unknown_suggest", "simd", "repl", "enhanced_repl", "static_commands", "multi_yaml", "advanced_benchmarks" ]
enabled = []
benchmarks = [ "simd", "clap", "pico-args", "benchkit", "num_cpus", "rand" ]

# New feature flags for advanced functionality
static_commands = [ ]
multi_yaml = [ "walkdir" ]
advanced_benchmarks = [ "benchmarks", "sysinfo", "static_commands", "multi_yaml" ]
advanced_cli_tests = [ ]

# WebAssembly-compatible feature set - excludes platform-specific dependencies
# No enhanced REPL (rustyline), no SIMD (platform detection issues), minimal dependencies
wasm = [ "enabled" ]

# Performance optimizations - SIMD enabled by default for maximum performance
# Can be disabled with: cargo build --no-default-features --features enabled
# This enables:
# - SIMD JSON parsing (simd-json: 4-25x faster than serde_json)
# - SIMD string operations in strs_tools (memchr, aho-corasick, bytecount)
# - SIMD tokenization in unilang_parser
simd = [ "simd-json", "memchr", "bytecount", "unilang_parser/simd" ]  # SIMD optimizations enabled by default

# REPL (Read-Eval-Print Loop) support - basic interactive shell functionality
repl = []

# Enhanced REPL with command history, auto-completion, and arrow key support
# Enables: Arrow key navigation, tab completion, secure input, session persistence
# Dependencies: rustyline (terminal handling), std::io::IsTerminal (interactive detection)
# Auto-fallback: Gracefully degrades to basic REPL in non-interactive environments
enhanced_repl = [ "repl", "dep:rustyline" ]

# This configuration suggests an action to be done when the command is unknown. In this case, when an unknown command is encountered, the system might suggest alternatives
on_unknown_suggest = [ ]

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"
url = "2.5.0"
chrono = { version = "0.4.38", features = ["serde"] }
regex = "1.10.4"
phf = { version = "0.11", features = ["macros"] }
walkdir = { version = "2.4", optional = true }
sysinfo = { version = "0.30", optional = true }

## internal
error_tools = { workspace = true, features = [ "enabled", "error_typed", "error_untyped" ] }
mod_interface = { workspace = true, features = [ "enabled" ] }
former = { workspace = true, features = [ "enabled", "derive_former" ] }
unilang_parser = { workspace = true } # SIMD features controlled by main unilang features

## external
log = "0.4"
rustyline = { version = "14.0", optional = true } # Enhanced REPL with history and arrow keys
indexmap = "2.2.6"
lru = "0.12.3" # LRU cache for hot command optimization

# Performance optimization dependencies
simd-json = { version = "0.13", optional = true } # SIMD-optimized JSON parsing
memchr = { version = "2.7", optional = true } # SIMD-optimized byte searching (6x faster than std)
bytecount = { version = "0.6", optional = true } # SIMD byte counting and operations

# Benchmark dependencies moved to dev-dependencies to avoid production inclusion
clap = { version = "4.4", optional = true }
pico-args = { version = "0.5", optional = true }
benchkit = { workspace = true, optional = true, features = [ "enabled", "markdown_reports", "data_generators", "statistical_analysis" ] }
num_cpus = { version = "1.16", optional = true }
rand = { version = "0.8", optional = true }

[[bin]]
name = "unilang_cli"
path = "src/bin/unilang_cli.rs"



# Benchmark binaries moved to standard directory structure per benchkit requirements



[[test]]
name = "command_loader_test"
path = "tests/inc/phase2/command_loader_test.rs"
[[test]]
name = "cli_integration_test"
path = "tests/inc/phase2/cli_integration_test.rs"

[[test]]
name = "help_generation_test"
path = "tests/inc/phase2/help_generation_test.rs"

[[test]]
name = "data_model_features_test"
path = "tests/inc/phase3/data_model_features_test.rs"

# Performance tests excluded from regular 'cargo test' - run manually if needed
# [[test]]
# name = "performance_stress_test"
# path = "tests/inc/phase4/performance_stress_test.rs"

# Criterion-based benchmarks for cargo bench (following benchkit standard directory compliance)
# [[bench]]
# name = "comprehensive_benchmark"
# path = "benches/comprehensive_framework_comparison.rs"
# harness = false

# [[bench]]
# name = "throughput_benchmark"
# path = "benches/throughput_benchmark.rs"
# harness = false

# [[bench]]
# name = "string_interning_benchmark"
# path = "benches/string_interning_benchmark.rs"
# harness = false

# [[bench]]
# name = "integrated_string_interning_benchmark"
# path = "benches/integrated_string_interning_benchmark.rs"
# harness = false

# [[bench]]
# name = "simd_json_benchmark"
# path = "benches/simd_json_benchmark.rs"
# harness = false

# [[bench]]
# name = "strs_tools_benchmark"
# path = "benches/strs_tools_benchmark.rs"
# harness = false

# [[bench]]
# name = "comparative_parsing_benchmark"
# path = "benches/comparative_parsing_benchmark.rs"
# harness = false

# [[bench]]
# name = "context_rich_documentation_demo"
# path = "benches/context_rich_documentation_demo.rs"
# harness = false

# [[bench]]
# name = "optimization_workflow_demo"
# path = "benches/optimization_workflow_demo.rs"
# harness = false

# [[bench]]
# name = "simd_tokenizer_benchmark"
# path = "benches/simd_tokenizer_benchmark.rs"
# harness = false

# [[bench]]
# name = "simple_json_perf_test"
# path = "benches/simple_json_perf_test.rs"
# harness = false

# [[bench]]
# name = "run_all_benchmarks"
# path = "benches/run_all_benchmarks.rs"
# harness = false

# [[bench]]
# name = "stress_test_bin"
# path = "benches/stress_test_bin.rs"
# harness = false

# [[bench]]
# name = "performance_stress_test"
# path = "benches/performance_stress_test.rs"
# harness = false

# [[bench]]
# name = "simd_json_performance_validation"
# path = "benches/simd_json_performance_validation.rs"
# harness = false

# Removed benchmark test entries for deleted files:
# - exponential_benchmark.rs (redundant with throughput)
# - framework_comparison.rs (2-way comparison removed)
# - parsing_benchmark_test.rs (rarely used)
# - clap_comparison_benchmark.rs (Clap-only testing removed)
# - true_exponential_benchmark.rs (redundant with comprehensive)



# stress_test_bin is a binary, not a test - no [[test]] entry needed

[[example]]
name = "help_conventions_demo"
path = "examples/18_help_conventions_demo.rs"





[build-dependencies]
serde = "1.0"
serde_yaml = "0.9"
phf_codegen = "0.11"
walkdir = "2.4"

[dev-dependencies]
test_tools = { workspace = true, features = [ "full" ] }
assert_cmd = "2.0"
predicates = "2.1"
assert_fs = "1.0"
clap = "4.4"
pico-args = "0.5"
chrono = "0.4"
tempfile = "3.8"

criterion = "0.5"

[package.metadata.cargo-udeps.ignore]
normal = ["num_cpus", "sysinfo"]
build = ["phf_codegen"]
